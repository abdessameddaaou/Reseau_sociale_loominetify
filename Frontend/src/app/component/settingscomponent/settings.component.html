<div class="min-h-screen app-bg flex flex-col" id="settings-page" data-testid="settings-page">
  <app-header [activeTab]="activeTab" (tabChange)="setActiveTab($event)" data-testid="settings-header">
  </app-header>

  <main class="flex-1" data-testid="settings-main">
    <div class="max-w-6xl mx-auto flex gap-6 px-4 py-6">

      <!-- ========================================================== -->
      <!-- ========================== Menu ========================== -->
      <!-- ========================================================== -->

      <aside class="hidden md:block w-64" id="settings-sidebar" data-testid="settings-sidebar">
        <div class="app-card rounded-2xl p-4">
          <h2 class="text-sm font-semibold text-slate-800 mb-3">
            {{ 'SETTINGS.TITLE' | translate }}
          </h2>
          <div class="flex flex-col gap-1 text-sm">
            <button type="button" id="settings-nav-profile" data-testid="settings-nav-profile"
              class="flex items-center gap-2 px-3 py-2 rounded-xl text-left transition"
              [ngClass]="section === 'profile' ? 'accent-pill font-semibold' : 'text-slate-600 hover:bg-slate-50'"
              (click)="setSection('profile')">
              <span class="w-5 flex justify-center"><i class="fa-solid fa-user"></i></span>
              <span>{{ 'SETTINGS.NAV_PROFILE' | translate }}</span>
            </button>

            <button type="button" id="settings-nav-security" data-testid="settings-nav-security"
              class="flex items-center gap-2 px-3 py-2 rounded-xl text-left transition"
              [ngClass]="section === 'security' ? 'accent-pill font-semibold' : 'text-slate-600 hover:bg-slate-50'"
              (click)="setSection('security')">
              <span class="w-5 flex justify-center"><i class="fa-solid fa-lock"></i></span>
              <span>{{ 'SETTINGS.NAV_SECURITY' | translate }}</span>
            </button>

            <button type="button" id="settings-nav-privacy" data-testid="settings-nav-privacy"
              class="flex items-center gap-2 px-3 py-2 rounded-xl text-left transition"
              [ngClass]="section === 'privacy' ? 'accent-pill font-semibold' : 'text-slate-600 hover:bg-slate-50'"
              (click)="setSection('privacy')">
              <span class="w-5 flex justify-center"><i class="fa-solid fa-shield-halved"></i></span>
              <span>{{ 'SETTINGS.NAV_PRIVACY' | translate }}</span>
            </button>

            <button type="button" id="settings-nav-notifications" data-testid="settings-nav-notifications"
              class="flex items-center gap-2 px-3 py-2 rounded-xl text-left transition"
              [ngClass]="section === 'notifications' ? 'accent-pill font-semibold' : 'text-slate-600 hover:bg-slate-50'"
              (click)="setSection('notifications')">
              <span class="w-5 flex justify-center"><i class="fa-solid fa-bell"></i></span>
              <span>{{ 'SETTINGS.NAV_NOTIFICATIONS' | translate }}</span>
            </button>

            <button type="button" id="settings-nav-appearance" data-testid="settings-nav-appearance"
              class="flex items-center gap-2 px-3 py-2 rounded-xl text-left transition"
              [ngClass]="section === 'appearance' ? 'accent-pill font-semibold' : 'text-slate-600 hover:bg-slate-50'"
              (click)="setSection('appearance')">
              <span class="w-5 flex justify-center"><i class="fa-solid fa-palette"></i></span>
              <span>{{ 'SETTINGS.NAV_APPEARANCE' | translate }}</span>
            </button>

            <button type="button" id="settings-nav-account" data-testid="settings-nav-account"
              class="flex items-center gap-2 px-3 py-2 rounded-xl text-left transition mt-2"
              [ngClass]="section === 'account' ? 'bg-rose-50 text-rose-600 font-semibold' : 'text-rose-600 hover:bg-rose-50'"
              (click)="setSection('account')">
              <span class="w-5 flex justify-center"><i class="fa-solid fa-user-slash"></i></span>
              <span>{{ 'SETTINGS.NAV_ACCOUNT' | translate }}</span>
            </button>
          </div>
        </div>
      </aside>

      <section class="flex-1 space-y-4" id="settings-content" data-testid="settings-content">

        <!-- ========================================================== -->
        <!-- ========================= Profile ======================== -->
        <!-- ========================================================== -->
        <form *ngIf="section === 'profile'" [formGroup]="userForm" (ngSubmit)="saveProfile()"
          class="app-card rounded-2xl p-5 md:p-6 space-y-5" id="settings-profile-section"
          data-testid="settings-profile-section">

          <div class="flex items-center justify-between gap-4">
            <div>
              <h2 class="text-lg font-semibold text-slate-900">{{ 'SETTINGS.PROFILE.TITLE' | translate }}</h2>
              <p class="text-xs text-slate-500">{{ 'SETTINGS.PROFILE.DESC' | translate }}</p>
            </div>
            <span *ngIf="profileSaved" class="text-[11px] text-emerald-500 font-medium"
              data-testid="profile-saved-indicator">
              {{ 'SETTINGS.SAVED' | translate }}
            </span>
          </div>

          <div class="grid lg:grid-cols-[2fr,1.5fr] gap-6">

            <div class="space-y-4 text-sm" data-testid="profile-form">

              <div class="flex flex-col sm:flex-row gap-4 items-center">
                <div class="relative">
                  <img
                    [src]="userForm.get('photo')?.value || 'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/767173db-56b6-454b-87d2-3ad554d47ff7.png'"
                    alt="Photo de profil" class="w-20 h-20 rounded-full object-cover border-4 border-white shadow"
                    id="profile-avatar-img" data-testid="profile-avatar-img" />

                  <label for="profile-avatar-input" id="profile-avatar-button" data-testid="profile-avatar-button"
                    class="absolute -bottom-1 -right-1 w-7 h-7 rounded-full btn-primary-gradient flex items-center justify-center text-[12px] shadow cursor-pointer"
                    title="Changer la photo">
                    <i class="fa-solid fa-camera"></i>
                  </label>

                  <input id="profile-avatar-input" type="file" accept="image/*" class="hidden"
                    (change)="onAvatarSelected($event)" />
                </div>

                <div class="text-xs text-slate-500">
                  <p class="mb-1 font-medium text-slate-700">{{ 'SETTINGS.PROFILE.PHOTO' | translate }}</p>
                  <p>{{ 'SETTINGS.PROFILE.PHOTO_INFO' | translate }}</p>
                </div>
              </div>

              <div class="grid md:grid-cols-2 gap-4 text-sm">
                <div>
                  <label for="profile-firstName" class="block text-xs font-medium text-slate-500 mb-1">{{
                    'SETTINGS.PROFILE.FIRST_NAME' | translate }}</label>
                  <input id="profile-firstName" name="profile-firstName" data-testid="profile-firstName-input"
                    type="text" formControlName="prenom"
                    class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm outline-none focus:border-[#5b7cff] focus:ring-2 focus:ring-[#5b7cff]/10" />
                </div>

                <div>
                  <label for="profile-lastName" class="block text-xs font-medium text-slate-500 mb-1">{{
                    'SETTINGS.PROFILE.LAST_NAME' | translate }}</label>
                  <input id="profile-lastName" name="profile-lastName" data-testid="profile-lastName-input" type="text"
                    formControlName="nom"
                    class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm outline-none focus:border-[#5b7cff] focus:ring-2 focus:ring-[#5b7cff]/10" />
                </div>

                <div>
                  <label for="profile-telephone" class="block text-xs font-medium text-slate-500 mb-1">{{
                    'SETTINGS.PROFILE.PHONE' | translate }}</label>
                  <input id="profile-telephone" name="profile-telephone" type="text" formControlName="telephone"
                    class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm outline-none focus:border-[#5b7cff] focus:ring-2 focus:ring-[#5b7cff]/10" />
                </div>

                <div>
                  <label for="profile-pays" class="block text-xs font-medium text-slate-500 mb-1">{{
                    'SETTINGS.PROFILE.COUNTRY' | translate }}</label>
                  <input id="profile-pays" name="profile-pays" type="text" formControlName="pays"
                    class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm outline-none focus:border-[#5b7cff] focus:ring-2 focus:ring-[#5b7cff]/10" />
                </div>

                <div>
                  <label for="profile-ville" class="block text-xs font-medium text-slate-500 mb-1">{{
                    'SETTINGS.PROFILE.CITY' | translate }}</label>
                  <input id="profile-ville" name="profile-ville" type="text" formControlName="ville"
                    class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm outline-none focus:border-[#5b7cff] focus:ring-2 focus:ring-[#5b7cff]/10" />
                </div>

                <div>
                  <label for="profile-profession" class="block text-xs font-medium text-slate-500 mb-1">{{
                    'SETTINGS.PROFILE.PROFESSION' | translate }}</label>
                  <input id="profile-profession" name="profile-profession" data-testid="profile-profession-input"
                    type="text" formControlName="profession"
                    [placeholder]="'SETTINGS.PROFILE.PROFESSION_PLACEHOLDER' | translate"
                    class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm outline-none focus:border-[#5b7cff] focus:ring-2 focus:ring-[#5b7cff]/10" />
                </div>

                <div>
                  <label for="profile-birthDate" class="block text-xs font-medium text-slate-500 mb-1">{{
                    'SETTINGS.PROFILE.BIRTH_DATE' | translate }}</label>
                  <input id="profile-birthDate" name="profile-birthDate" data-testid="profile-birthDate-input"
                    type="date" formControlName="dateNaissance"
                    class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm outline-none focus:border-[#5b7cff] focus:ring-2 focus:ring-[#5b7cff]/10" />
                  <p class="text-[11px] text-slate-400 mt-1">{{ 'SETTINGS.PROFILE.BIRTH_DATE_INFO' | translate }}</p>
                </div>

                <div>
                  <label for="profile-website" class="block text-xs font-medium text-slate-500 mb-1">{{
                    'SETTINGS.PROFILE.WEBSITE' | translate }}</label>
                  <input id="profile-website" name="profile-website" data-testid="profile-website-input" type="url"
                    formControlName="siteweb" placeholder="https://…"
                    class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm outline-none focus:border-[#5b7cff] focus:ring-2 focus:ring-[#5b7cff]/10" />
                </div>

                <div>
                  <label class="block text-xs font-medium text-slate-500 mb-1">{{ 'SETTINGS.PROFILE.INTERESTS' |
                    translate }}</label>
                  <div class="flex flex-wrap gap-2 min-h-[32px] mb-2">
                    <span *ngFor="let tag of userForm.get('hashtags')?.value"
                      class="flex items-center gap-2 px-3 py-1 bg-slate-100 text-slate-700 rounded-full text-xs border border-slate-200">
                      {{ tag }}
                      <button type="button" (click)="removeHashtag(tag)" class="hover:text-rose-500 ml-1">
                        <i class="fa-solid fa-xmark text-[10px]"></i>
                      </button>
                    </span>
                  </div>
                  <div class="flex gap-2">
                    <div class="relative flex-1">
                      <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm">#</span>
                      <input #tagInput type="text" [placeholder]="'SETTINGS.PROFILE.INTERESTS_PLACEHOLDER' | translate"
                        (keydown.enter)="$event.preventDefault(); addHashtag(tagInput)"
                        class="w-full rounded-xl border border-slate-200 pl-7 pr-3 py-2 text-sm outline-none focus:border-[#5b7cff]" />
                    </div>
                    <button type="button" (click)="addHashtag(tagInput)"
                      class="px-4 py-2 bg-slate-800 text-white rounded-xl text-xs font-semibold">
                      {{ 'SETTINGS.PROFILE.ADD' | translate }}
                    </button>
                  </div>
                </div>
                <div>
                  <label for="profile-relationStatus" class="block text-xs font-medium text-slate-500 mb-1">
                    {{ 'SETTINGS.PROFILE.RELATIONSHIP' | translate }}
                  </label>

                  <div class="relative">
                    <select id="profile-relationStatus" name="profile-relationStatus" formControlName="relationStatus"
                      class="w-full h-[40px] rounded-xl border border-slate-200 bg-white px-3 pr-10 text-sm outline-none
                              focus:border-[#5b7cff] focus:ring-2 focus:ring-[#5b7cff]/10 appearance-none">
                      <option [ngValue]="null">{{ 'SETTINGS.PROFILE.RELATIONSHIP_UNSPECIFIED' | translate }}</option>
                      <option *ngFor="let opt of relationStatusOptions" [value]="opt.value">
                        {{ opt.label | translate }}
                      </option>
                    </select>
                    <i
                      class="fa-solid fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs pointer-events-none"></i>
                  </div>
                </div>
                <div class="md:col-span-2">
                  <label for="profile-bio" class="block text-xs font-medium text-slate-500 mb-1">{{
                    'SETTINGS.PROFILE.BIO' | translate }}</label>
                  <textarea id="profile-bio" name="profile-bio" data-testid="profile-bio-textarea" rows="3"
                    formControlName="bio"
                    class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm outline-none focus:border-[#5b7cff] focus:ring-2 focus:ring-[#5b7cff]/10 resize-none"
                    [placeholder]="'SETTINGS.PROFILE.BIO_PLACEHOLDER' | translate"></textarea>
                </div>
              </div>
              <div class="flex justify-end pt-2">
                <button type="submit" id="profile-save-btn" data-testid="profile-save-btn"
                  class="inline-flex items-center gap-2 rounded-full btn-primary-gradient px-5 py-2 text-xs font-semibold shadow-md">
                  <i class="fa-solid fa-floppy-disk text-[11px]"></i>
                  {{ 'SETTINGS.SAVE_BTN' | translate }}
                </button>
              </div>

            </div>
            <div class="app-card rounded-2xl overflow-hidden self-start" id="profile-preview-card"
              data-testid="profile-preview-card">
              <div class="h-16 accent-gradient"></div>
              <div class="p-4 -mt-8 flex flex-col items-center">
                <img
                  [src]="userForm.get('photo')?.value || 'https://user-gen-media-assets.s3.amazonaws.com/seedream_images/767173db-56b6-454b-87d2-3ad554d47ff7.png'"
                  class="w-16 h-16 rounded-full border-4 border-white object-cover" alt="Photo de profil"
                  data-testid="profile-preview-avatar" />

                <p class="mt-2 text-sm font-semibold text-slate-800" data-testid="profile-preview-name">
                  {{ userForm.get('prenom')?.value }} {{ userForm.get('nom')?.value }}
                </p>

                <p *ngIf="userForm.get('ville')?.value || userForm.get('pays')?.value"
                  class="mt-1 text-[11px] text-slate-500 text-center">
                  {{ userForm.get('ville')?.value }}
                  <span *ngIf="userForm.get('pays')?.value">
                    · {{ userForm.get('pays')?.value }}
                  </span>
                </p>

                <p *ngIf="userForm.get('telephone')?.value" class="text-[11px] text-slate-400 mt-0.5">
                  Tél : {{ userForm.get('telephone')?.value }}
                </p>

                <p *ngIf="userForm.get('siteweb')?.value" class="text-[11px] text-slate-400 mt-0.5">
                  {{ userForm.get('siteweb')?.value }}
                </p>

                <p *ngIf="userForm.get('profession')?.value" class="text-[11px] text-slate-400 mt-0.5">
                  {{ userForm.get('profession')?.value }}
                </p>

                <p *ngIf="userForm.get('bio')?.value" class="mt-3 text-[11px] text-slate-600 text-center"
                  data-testid="profile-preview-bio">
                  {{ userForm.get('bio')?.value }}
                </p>
              </div>
            </div>

          </div>
        </form>

        <!-- ============================================================= -->
        <!-- ===================== Sécurité du compte ==================== -->
        <!-- ============================================================= -->
        <div *ngIf="section === 'security'" class="app-card rounded-2xl p-5 md:p-6 space-y-5"
          id="settings-security-section" data-testid="settings-security-section">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-lg font-semibold text-slate-900">{{ 'SETTINGS.SECURITY.TITLE' | translate }}</h2>
              <p class="text-xs text-slate-500">{{ 'SETTINGS.SECURITY.DESC' | translate }}</p>
            </div>
            <span *ngIf="securitySaved" class="text-[11px] text-emerald-500 font-medium"
              data-testid="security-saved-indicator">
              {{ 'SETTINGS.SAVED' | translate }}
            </span>
          </div>

          <div class="grid md:grid-cols-2 gap-5 text-sm">
            <div class="space-y-4" data-testid="security-form">
              <div class="grid gap-3">
                <div>
                  <label for="security-currentPassword" class="block text-xs font-medium text-slate-500 mb-1">{{
                    'SETTINGS.SECURITY.CURRENT_PASSWORD' | translate }}</label>
                  <input id="security-currentPassword" name="security-currentPassword"
                    data-testid="security-currentPassword-input" type="password"
                    [(ngModel)]="securityForm.currentPassword"
                    class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm outline-none focus:border-[#5b7cff] focus:ring-2 focus:ring-[#5b7cff]/10" />
                </div>

                <div>
                  <label for="security-newPassword" class="block text-xs font-medium text-slate-500 mb-1">{{
                    'SETTINGS.SECURITY.NEW_PASSWORD' | translate }}</label>
                  <input id="security-newPassword" name="security-newPassword" data-testid="security-newPassword-input"
                    type="password" [(ngModel)]="securityForm.newPassword"
                    class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm outline-none focus:border-[#5b7cff] focus:ring-2 focus:ring-[#5b7cff]/10" />
                </div>

                <div>
                  <label for="security-confirmPassword" class="block text-xs font-medium text-slate-500 mb-1">{{
                    'SETTINGS.SECURITY.CONFIRM_PASSWORD' | translate }}</label>
                  <input id="security-confirmPassword" name="security-confirmPassword"
                    data-testid="security-confirmPassword-input" type="password"
                    [(ngModel)]="securityForm.confirmPassword"
                    class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm outline-none focus:border-[#5b7cff] focus:ring-2 focus:ring-[#5b7cff]/10" />
                  <p *ngIf="passwordsDontMatch" class="text-[11px] text-red-500 mt-1"
                    data-testid="security-passwords-error">
                    {{ 'SETTINGS.SECURITY.PASSWORDS_DONT_MATCH' | translate }}
                  </p>
                </div>
              </div>

              <div class="rounded-xl app-soft px-4 py-3 flex items-start gap-3 text-xs"
                data-testid="security-2fa-block">
                <div class="w-7 h-7 rounded-full bg-white flex items-center justify-center shadow-sm text-accent">
                  <i class="fa-solid fa-shield-halved text-[12px]"></i>
                </div>
                <div class="flex-1">
                  <div class="flex items-center justify-between mb-1">
                    <p class="font-semibold text-slate-800">{{ 'SETTINGS.SECURITY.TWO_FACTOR_TITLE' | translate }}</p>
                    <label class="inline-flex items-center cursor-pointer" for="security-twoFactorEnabled">
                      <input id="security-twoFactorEnabled" name="security-twoFactorEnabled"
                        data-testid="security-twoFactor-checkbox" type="checkbox" class="sr-only"
                        [(ngModel)]="securityForm.twoFactorEnabled" />
                      <span class="w-9 h-5 flex items-center rounded-full p-0.5 transition"
                        [ngClass]="securityForm.twoFactorEnabled ? 'toggle-accent-on' : 'bg-slate-300'">
                        <span class="bg-white w-4 h-4 rounded-full shadow transform transition"
                          [ngClass]="securityForm.twoFactorEnabled ? 'translate-x-4' : ''"></span>
                      </span>
                    </label>
                  </div>
                  <p class="text-slate-500">{{ 'SETTINGS.SECURITY.TWO_FACTOR_DESC' | translate }}</p>
                </div>
              </div>
            </div>

            <div class="space-y-3 text-sm">
              <p class="text-xs font-semibold text-slate-500">{{ 'SETTINGS.SECURITY.RECENT_SESSIONS' | translate }}</p>
              <div class="rounded-xl app-soft px-3 py-2 space-y-2 max-h-40 overflow-y-auto"
                data-testid="security-sessions-list">
                <div *ngFor="let session of recentSessions"
                  class="flex items-center justify-between text-[11px] bg-white rounded-lg px-3 py-2 shadow-sm"
                  data-testid="security-session-item">
                  <div>
                    <p class="font-semibold text-slate-700">{{ session.device }}</p>
                    <p class="text-slate-400">{{ session.location }} · {{ session.time }}</p>
                  </div>
                  <span class="px-2 py-0.5 rounded-full text-[10px]"
                    [ngClass]="session.current ? 'bg-emerald-50 text-emerald-600' : 'bg-slate-100 text-slate-500'">
                    {{ session.current ? ('SETTINGS.SECURITY.ACTIVE_SESSION' | translate) :
                    ('SETTINGS.SECURITY.DISCONNECTED' | translate) }}
                  </span>
                </div>
              </div>
              <button type="button" id="security-logout-all-btn" data-testid="security-logout-all-btn"
                class="text-[11px] text-accent hover:underline mt-1" (click)="logoutAllDevices()">
                {{ 'SETTINGS.SECURITY.LOGOUT_ALL' | translate }}
              </button>
            </div>
          </div>

          <div class="flex justify-end pt-2">
            <button type="button" id="security-save-btn" data-testid="security-save-btn" (click)="saveSecurity()"
              class="inline-flex items-center gap-2 rounded-full btn-primary-gradient px-5 py-2 text-xs font-semibold text-white shadow-md">
              <i class="fa-solid fa-shield-check text-[11px]"></i>
              {{ 'SETTINGS.UPDATE_BTN' | translate }}
            </button>
          </div>
        </div>

        <!-- ============================================================= -->
        <!-- ====================== Confidentialité ====================== -->
        <!-- ============================================================= -->
        <div *ngIf="section === 'privacy'" class="app-card rounded-2xl p-5 md:p-6 space-y-5"
          id="settings-privacy-section" data-testid="settings-privacy-section">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-lg font-semibold text-slate-900">{{ 'SETTINGS.PRIVACY.TITLE' | translate }}</h2>
              <p class="text-xs text-slate-500">{{ 'SETTINGS.PRIVACY.DESC' | translate }}</p>
            </div>
            <span *ngIf="privacySaved" class="text-[11px] text-emerald-500 font-medium"
              data-testid="privacy-saved-indicator">
              {{ 'SETTINGS.SAVED' | translate }}
            </span>
          </div>

          <div class="space-y-4 text-sm">
            <div>
              <p class="text-xs font-medium text-slate-500 mb-1">{{ 'SETTINGS.PRIVACY.PROFILE_VISIBILITY' | translate }}
              </p>
              <div class="flex flex-wrap gap-2">
                <button type="button" id="privacy-visibility-public" data-testid="privacy-visibility-public"
                  class="px-3 py-1.5 rounded-full border text-xs"
                  [ngClass]="privacyForm.profileVisibility === 'public' ? 'border-accent bg-accent-soft' : 'border-slate-200 text-slate-600'"
                  (click)="privacyForm.profileVisibility = 'public'">
                  {{ 'SETTINGS.PRIVACY.PUBLIC' | translate }}
                </button>
                <button type="button" id="privacy-visibility-friends" data-testid="privacy-visibility-friends"
                  class="px-3 py-1.5 rounded-full border text-xs"
                  [ngClass]="privacyForm.profileVisibility === 'friends' ? 'border-accent bg-accent-soft' : 'border-slate-200 text-slate-600'"
                  (click)="privacyForm.profileVisibility = 'friends'">
                  {{ 'SETTINGS.PRIVACY.FRIENDS_ONLY' | translate }}
                </button>
                <button type="button" id="privacy-visibility-private" data-testid="privacy-visibility-private"
                  class="px-3 py-1.5 rounded-full border text-xs"
                  [ngClass]="privacyForm.profileVisibility === 'private' ? 'border-accent bg-accent-soft' : 'border-slate-200 text-slate-600'"
                  (click)="privacyForm.profileVisibility = 'private'">
                  {{ 'SETTINGS.PRIVACY.PRIVATE' | translate }}
                </button>
              </div>
            </div>

            <div class="flex items-center justify-between gap-4">
              <div>
                <p class="text-sm text-slate-800">{{ 'SETTINGS.PRIVACY.SHOW_ONLINE' | translate }}</p>
                <p class="text-xs text-slate-500">{{ 'SETTINGS.PRIVACY.SHOW_ONLINE_DESC' | translate }}</p>
              </div>
              <label class="inline-flex items-center cursor-pointer" for="privacy-showOnline">
                <input id="privacy-showOnline" name="privacy-showOnline" data-testid="privacy-showOnline-checkbox"
                  type="checkbox" class="sr-only" [(ngModel)]="privacyForm.showOnline" />
                <span class="w-9 h-5 flex items-center rounded-full p-0.5 transition"
                  [ngClass]="privacyForm.showOnline ? 'toggle-accent-on' : 'bg-slate-300'">
                  <span class="bg-white w-4 h-4 rounded-full shadow transform transition"
                    [ngClass]="privacyForm.showOnline ? 'translate-x-4' : ''"></span>
                </span>
              </label>
            </div>

            <div class="flex items-center justify-between gap-4">
              <div>
                <p class="text-sm text-slate-800">{{ 'SETTINGS.PRIVACY.WHO_CAN_MESSAGE' | translate }}</p>
              </div>
              <select id="privacy-messagesFrom" name="privacy-messagesFrom" data-testid="privacy-messagesFrom-select"
                [(ngModel)]="privacyForm.messagesFrom"
                class="text-xs rounded-xl border border-slate-200 px-3 py-1.5 outline-none focus:border-[#5b7cff] focus:ring-2 focus:ring-[#5b7cff]/10 bg-white">
                <option value="everyone">{{ 'SETTINGS.PRIVACY.EVERYONE' | translate }}</option>
                <option value="friends">{{ 'SETTINGS.PRIVACY.FRIENDS_ONLY_OPT' | translate }}</option>
                <option value="none">{{ 'SETTINGS.PRIVACY.NO_ONE' | translate }}</option>
              </select>
            </div>

            <div class="flex items-center justify-between gap-4">
              <div>
                <p class="text-sm text-slate-800">{{ 'SETTINGS.PRIVACY.ALLOW_TAGGING' | translate }}</p>
                <p class="text-xs text-slate-500">{{ 'SETTINGS.PRIVACY.ALLOW_TAGGING_DESC' | translate }}</p>
              </div>
              <label class="inline-flex items-center cursor-pointer" for="privacy-allowTagging">
                <input id="privacy-allowTagging" name="privacy-allowTagging" data-testid="privacy-allowTagging-checkbox"
                  type="checkbox" class="sr-only" [(ngModel)]="privacyForm.allowTagging" />
                <span class="w-9 h-5 flex items-center rounded-full p-0.5 transition"
                  [ngClass]="privacyForm.allowTagging ? 'toggle-accent-on' : 'bg-slate-300'">
                  <span class="bg-white w-4 h-4 rounded-full shadow transform transition"
                    [ngClass]="privacyForm.allowTagging ? 'translate-x-4' : ''"></span>
                </span>
              </label>
            </div>
          </div>

          <div class="flex justify-end pt-2">
            <button type="button" id="privacy-save-btn" data-testid="privacy-save-btn" (click)="savePrivacy()"
              class="inline-flex items-center gap-2 rounded-full btn-primary-gradient px-5 py-2 text-xs font-semibold text-white shadow-md">
              <i class="fa-solid fa-shield-halved text-[11px]"></i>
              {{ 'SETTINGS.SAVE_BTN' | translate }}
            </button>
          </div>
        </div>

        <!-- ============================================================= -->
        <!-- ======================= Notifications======================== -->
        <!-- ============================================================= -->

        <div *ngIf="section === 'notifications'" class="app-card rounded-2xl p-5 md:p-6 space-y-5"
          id="settings-notifications-section" data-testid="settings-notifications-section">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-lg font-semibold text-slate-900">{{ 'SETTINGS.NOTIFICATIONS.TITLE' | translate }}</h2>
              <p class="text-xs text-slate-500">{{ 'SETTINGS.NOTIFICATIONS.DESC' | translate }}</p>
            </div>
            <span *ngIf="notificationsSaved" class="text-[11px] text-emerald-500 font-medium"
              data-testid="notifications-saved-indicator">
              {{ 'SETTINGS.SAVED' | translate }}
            </span>
          </div>

          <div class="grid md:grid-cols-2 gap-6 text-sm">
            <div class="space-y-3">
              <p class="text-xs font-semibold text-slate-500">{{ 'SETTINGS.NOTIFICATIONS.BY_EMAIL' | translate }}</p>
              <label class="flex items-center justify-between gap-4" for="notif-emailLikes">
                <span class="text-slate-700 text-sm">{{ 'SETTINGS.NOTIFICATIONS.LIKES' | translate }}</span>
                <input id="notif-emailLikes" name="notif-emailLikes" data-testid="notif-emailLikes-checkbox"
                  type="checkbox" [(ngModel)]="notificationsForm.emailLikes" />
              </label>
              <label class="flex items-center justify-between gap-4" for="notif-emailComments">
                <span class="text-slate-700 text-sm">{{ 'SETTINGS.NOTIFICATIONS.COMMENTS' | translate }}</span>
                <input id="notif-emailComments" name="notif-emailComments" data-testid="notif-emailComments-checkbox"
                  type="checkbox" [(ngModel)]="notificationsForm.emailComments" />
              </label>
              <label class="flex items-center justify-between gap-4" for="notif-emailFollowers">
                <span class="text-slate-700 text-sm">{{ 'SETTINGS.NOTIFICATIONS.FOLLOWERS' | translate }}</span>
                <input id="notif-emailFollowers" name="notif-emailFollowers" data-testid="notif-emailFollowers-checkbox"
                  type="checkbox" [(ngModel)]="notificationsForm.emailFollowers" />
              </label>
            </div>

            <div class="space-y-3">
              <p class="text-xs font-semibold text-slate-500">{{ 'SETTINGS.NOTIFICATIONS.IN_APP' | translate }}</p>
              <label class="flex items-center justify-between gap-4" for="notif-pushMessages">
                <span class="text-slate-700 text-sm">{{ 'SETTINGS.NOTIFICATIONS.MESSAGES' | translate }}</span>
                <input id="notif-pushMessages" name="notif-pushMessages" data-testid="notif-pushMessages-checkbox"
                  type="checkbox" [(ngModel)]="notificationsForm.pushMessages" />
              </label>
              <label class="flex items-center justify-between gap-4" for="notif-pushReminders">
                <span class="text-slate-700 text-sm">{{ 'SETTINGS.NOTIFICATIONS.REMINDERS' | translate }}</span>
                <input id="notif-pushReminders" name="notif-pushReminders" data-testid="notif-pushReminders-checkbox"
                  type="checkbox" [(ngModel)]="notificationsForm.pushReminders" />
              </label>
              <label class="flex items-center justify-between gap-4" for="notif-pushFavorites">
                <span class="text-slate-700 text-sm">{{ 'SETTINGS.NOTIFICATIONS.FAVORITES' | translate }}</span>
                <input id="notif-pushFavorites" name="notif-pushFavorites" data-testid="notif-pushFavorites-checkbox"
                  type="checkbox" [(ngModel)]="notificationsForm.pushFavorites" />
              </label>
            </div>
          </div>

          <div class="flex justify-end pt-2">
            <button type="button" id="notifications-save-btn" data-testid="notifications-save-btn"
              (click)="saveNotifications()"
              class="inline-flex items-center gap-2 rounded-full btn-primary-gradient px-5 py-2 text-xs font-semibold text-white shadow-md">
              <i class="fa-solid fa-bell text-[11px]"></i>
              {{ 'SETTINGS.SAVE_BTN' | translate }}
            </button>
          </div>
        </div>

        <div *ngIf="section === 'appearance'" class="app-card rounded-2xl p-5 md:p-6 space-y-5"
          id="settings-appearance-section" data-testid="settings-appearance-section">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-lg font-semibold text-slate-900">{{ 'SETTINGS.APPEARANCE.TITLE' | translate }}</h2>
              <p class="text-xs text-slate-500">{{ 'SETTINGS.APPEARANCE.DESC' | translate }}</p>
            </div>
            <span *ngIf="appearanceSaved" class="text-[11px] text-emerald-500 font-medium"
              data-testid="appearance-saved-indicator">
              {{ 'SETTINGS.SAVED' | translate }}
            </span>
          </div>

          <div class="grid md:grid-cols-2 gap-6 text-sm">
            <div class="space-y-4">
              <div>
                <p class="text-xs font-semibold text-slate-500 mb-1">{{ 'SETTINGS.APPEARANCE.THEME' | translate }}</p>
                <div class="flex gap-2">
                  <button type="button" id="appearance-theme-light" data-testid="appearance-theme-light"
                    class="flex-1 px-3 py-2 rounded-xl border text-xs flex items-center justify-between"
                    [ngClass]="appearanceForm.theme === 'light' ? 'border-accent bg-accent-soft' : 'border-slate-200 text-slate-600'"
                    (click)="appearanceForm.theme = 'light'">
                    <span>{{ 'SETTINGS.APPEARANCE.LIGHT' | translate }}</span>
                    <i class="fa-regular fa-sun"></i>
                  </button>
                  <button type="button" id="appearance-theme-dark" data-testid="appearance-theme-dark"
                    class="flex-1 px-3 py-2 rounded-xl border text-xs flex items-center justify-between"
                    [ngClass]="appearanceForm.theme === 'dark' ? 'border-accent bg-accent-soft' : 'border-slate-200 text-slate-600'"
                    (click)="appearanceForm.theme = 'dark'">
                    <span>{{ 'SETTINGS.APPEARANCE.DARK' | translate }}</span>
                    <i class="fa-regular fa-moon"></i>
                  </button>
                  <button type="button" id="appearance-theme-system" data-testid="appearance-theme-system"
                    class="flex-1 px-3 py-2 rounded-xl border text-xs flex items-center justify-between"
                    [ngClass]="appearanceForm.theme === 'system' ? 'border-accent bg-accent-soft' : 'border-slate-200 text-slate-600'"
                    (click)="appearanceForm.theme = 'system'">
                    <span>{{ 'SETTINGS.APPEARANCE.SYSTEM' | translate }}</span>
                    <i class="fa-solid fa-display"></i>
                  </button>
                </div>
              </div>

              <div>
                <p class="text-xs font-semibold text-slate-500 mb-1">{{ 'SETTINGS.APPEARANCE.ACCENT_COLOR' | translate
                  }}</p>
                <div class="flex gap-3" data-testid="appearance-accent-list">
                  <button *ngFor="let color of accentColors" type="button"
                    class="w-8 h-8 rounded-full border-2 flex items-center justify-center"
                    [attr.id]="'appearance-accent-' + color.id" [attr.data-testid]="'appearance-accent-' + color.id"
                    [ngClass]="appearanceForm.accent === color.id ? 'border-slate-900' : 'border-transparent'"
                    (click)="appearanceForm.accent = color.id">
                    <span class="w-6 h-6 rounded-full block" [ngStyle]="{ 'background': color.value }"></span>
                  </button>
                </div>
              </div>
            </div>

            <div class="rounded-2xl app-soft px-4 py-4 text-xs text-slate-500" id="appearance-preview-card"
              data-testid="appearance-preview-card">
              <p class="font-semibold text-slate-700 mb-2">{{ 'SETTINGS.APPEARANCE.PREVIEW' | translate }}</p>
              <div class="rounded-xl bg-white shadow-sm p-3 flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded-full bg-slate-200"></div>
                  <div>
                    <div class="h-2.5 w-24 bg-slate-200 rounded mb-1"></div>
                    <div class="h-2 w-16 bg-slate-100 rounded"></div>
                  </div>
                </div>
                <span class="inline-flex items-center justify-center px-3 py-1 rounded-full text-[10px] text-white"
                  [ngStyle]="{ 'background': selectedAccent?.value }" data-testid="appearance-preview-button">
                  {{ 'SETTINGS.APPEARANCE.BUTTON' | translate }}
                </span>
              </div>
              <p class="mt-3">
                {{ 'SETTINGS.APPEARANCE.PREVIEW_DESC' | translate }}
              </p>
            </div>
          </div>

          <div class="flex justify-end pt-2">
            <button type="button" id="appearance-save-btn" data-testid="appearance-save-btn" (click)="saveAppearance()"
              class="inline-flex items-center gap-2 rounded-full btn-primary-gradient px-5 py-2 text-xs font-semibold text-white shadow-md">
              <i class="fa-solid fa-palette text-[11px]"></i>
              {{ 'SETTINGS.SAVE_BTN' | translate }}
            </button>
          </div>
        </div>

        <!-- ============================================================= -->
        <!-- ==================== Paramètres du compte =================== -->
        <!-- ============================================================= -->

        <div *ngIf="section === 'account'" class="app-card rounded-2xl p-5 md:p-6 space-y-5"
          id="settings-account-section" data-testid="settings-account-section">
          <div class="flex items-center justify-between">


            <div>
              <h2 class="text-lg font-semibold text-slate-900">{{ 'SETTINGS.ACCOUNT.TITLE' | translate }}</h2>
              <p class="text-xs text-slate-500">{{ 'SETTINGS.ACCOUNT.DESC' | translate }}</p>
            </div>
          </div>

          <div class="space-y-4 text-sm" data-testid="account-form">
            <div class="flex items-center justify-between gap-4">
              <div>
                <p class="text-sm text-slate-800">{{ 'SETTINGS.ACCOUNT.LANGUAGE' | translate }}</p>
                <p class="text-xs text-slate-500">{{ 'SETTINGS.ACCOUNT.LANGUAGE_DESC' | translate }}</p>
              </div>
              <select id="account-language" name="account-language" data-testid="account-language-select"
                [(ngModel)]="accountForm.language" (ngModelChange)="changeLanguage($event)"
                class="text-xs rounded-xl border border-slate-200 px-3 py-1.5 outline-none focus:border-[#5b7cff] focus:ring-2 focus:ring-[#5b7cff]/10 bg-white">
                <option value="fr">Français</option>
                <option value="en">English</option>
              </select>
            </div>

            <div class="rounded-xl app-soft px-4 py-3 flex items-center justify-between gap-4">
              <div>
                <p class="text-sm text-slate-800">{{ 'SETTINGS.ACCOUNT.DOWNLOAD_DATA' | translate }}</p>
                <p class="text-xs text-slate-500">{{ 'SETTINGS.ACCOUNT.DOWNLOAD_DATA_DESC' | translate }}</p>
              </div>
              <button type="button" id="account-download-data-btn" data-testid="account-download-data-btn"
                class="px-4 py-1.5 rounded-full text-[11px] bg-white border border-slate-200 text-slate-700 hover:bg-slate-100"
                (click)="downloadData()">
                {{ 'SETTINGS.ACCOUNT.DOWNLOAD_BTN' | translate }}
              </button>
            </div>

            <div class="pt-3 border-t border-slate-100">
              <p class="text-xs font-semibold text-rose-500 mb-1">{{ 'SETTINGS.ACCOUNT.DANGER_ZONE' | translate }}</p>
              <p class="text-xs text-slate-500 mb-3">
                {{ 'SETTINGS.ACCOUNT.DELETE_DESC' | translate }}
              </p>
              <button type="button" id="account-delete-request-btn" data-testid="account-delete-request-btn"
                class="px-4 py-2 rounded-full text-[11px] bg-rose-50 text-rose-600 border border-rose-200 hover:bg-rose-100"
                (click)="requestAccountDeletion()">
                {{ 'SETTINGS.ACCOUNT.DELETE_BTN' | translate }}
              </button>
            </div>
          </div>
        </div>

      </section>
    </div>
  </main>
</div>